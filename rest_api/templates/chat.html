<!DOCTYPE html>
<html lang="en">
<head>
    <title>{{ current_user.username }}</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <style>
      body {
        margin: 0;
        font-family: Arial, Helvetica, sans-serif;
      }
      
      .topnav {
        overflow: hidden;
        background-color: #333;
        position: fixed;
        width: 100%;
      }
      
      .topnav a {
        float: left;
        color: #f2f2f2;
        text-align: center;
        padding: 14px 16px;
        text-decoration: none;
        font-size: 17px;
      }
      
      .topnav a:hover {
        background-color: #ddd;
        color: black;
      }
      
      .topnav a.active {
        background-color: #4CAF50;
        color: white;
      }
      
      .topnav-right {
        float: right;
      }

      .receiver_user {
        background-color: #C5C5C5;
        color: #333;
      }
      </style>

<style>
  body {
    font-family: "Lato", sans-serif;
  }
  
  /* Fixed sidenav, full height */
  .sidenav {
    height: 100%;
    width: 200px;
    position: fixed;
    z-index: 1;
    top: 4.2%;
    left: 0;
    background-color: #C5C5C5;
    overflow-x: hidden;
    padding-top: 20px;
  }
  
  /* Style the sidenav links and the dropdown button */
  .sidenav a, .dropdown-btn {
    padding: 6px 8px 6px 16px;
    text-decoration: none;
    font-size: 20px;
    color: #333;
    display: block;
    border: none;
    background: none;
    width: 100%;
    text-align: left;
    cursor: pointer;
    outline: none;
  }
  
  /* On mouse-over */
  .sidenav a:hover, .dropdown-btn:hover {
    color: #f1f1f1;
  }

  .section {
    padding-left: 20px;
    background-color: #333;
    color: white;
    height: 35px;
    padding-top: 5px;
  }
  
  /* Main content */
  .main {
    margin-left: 200px; /* Same as the width of the sidenav */
    font-size: 18px; /* Increased text to enable scrolling */
    padding: 40px 20px;
    padding-bottom: 170px;
    height: auto;
  }
  
  /* Some media queries for responsiveness */
  @media screen and (max-height: 450px) {
    .sidenav {padding-top: 15px;}
    .sidenav a {font-size: 18px;}
  }

  .dropbtn {
      background-color: #4CAF50;
      color: white;
      padding: 16px;
      font-size: 16px;
      border: none;
      cursor: pointer;
    }

  .dropbtn:hover, .dropbtn:focus {
      background-color: #3e8e41;
  }

  #myInput {
      box-sizing: border-box;
      background-image: url('searchicon.png');
      background-position: 14px 12px;
      background-repeat: no-repeat;
      font-size: 16px;
      padding: 14px 20px 12px 45px;
      border: none;
      border-bottom: 1px solid #ddd;
    }
    
    #myInput:focus {outline: 3px solid #ddd;}

    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f6f6f6;
      min-width: 230px;
      overflow: auto;
      border: 1px solid #ddd;
      z-index: 1;
    }

    .dropdown-content a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
    }

    .dropdown a:hover {background-color: #ddd;}
    
    .show {display: block;}

    .footer {
    background: #C5C5C5;
    padding-right: 20px;
    position: fixed;
    left: 200px;
    right: 0;
    bottom: 0;
    height: 170px;
    color: black;
    }    


   .send {
      background-color: #4CAF50;
      color: white;
      padding: 16px;
      font-size: 16px;
      border: none;
      cursor: pointer;
    }

    .container {
      max-width: 100%;
      margin: 0px auto;
      margin-top: 3px;
    }

  </style>

</head>
<body>

<div class="topnav">
  <a class="active" href="{{ url_for('home', username=current_user.username) }}">{{ current_user.username }}</a>
  <a href="{{ url_for('chats', username=current_user.username) }}">Chats</a>
  <a href="{{ url_for('groups', username=current_user.username) }}">Groups</a>
  <a class="receiver_user">{{ receiver.username }}</a>
  <div class="topnav-right">
    <a href="{{ url_for('logOut')}}"><span class="glyphicon glyphicon-log-in"></span> Logout</a>
  </div>
</div>

<div class="sidenav">
  <h3 class="section">New Chat</h3>
  <div class="dropdown">
    <button onclick="myFunction()" class="dropbtn">Select User</button>
    <div id="myDropdown" class="dropdown-content">
      <input type="text" placeholder="Search.." id="myInput" onkeyup="filterFunction()">
      {% for user in rest_users %}
      <a href="{{ url_for('new_chat', username=current_user.username, new_chat_user=user.id) }}">{{user.username}}</a>
      {% endfor %}
    </div>
  </div>
  <script>
    /* When the user clicks on the button,
    toggle between hiding and showing the dropdown content */
    function myFunction() {
      document.getElementById("myDropdown").classList.toggle("show");
    }
    
    function filterFunction() {
      var input, filter, ul, li, a, i;
      input = document.getElementById("myInput");
      filter = input.value.toUpperCase();
      div = document.getElementById("myDropdown");
      a = div.getElementsByTagName("a");
      for (i = 0; i < a.length; i++) {
        txtValue = a[i].textContent || a[i].innerText;
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
          a[i].style.display = "";
        } else {
          a[i].style.display = "none";
        }
      }
    }
    </script>
  <h3 class="section">Chats</h3>
  {% for chat in chats %}
  <a href="{{ url_for('chat', username=current_user.username, chat_e=chat.id) }}">{{chat.other_user(current_user.id, User).username}}</a>
  {% endfor %}
</div>

<!-- Receiver -->
<div class="main">
<br>
<!-- Messages -->
{% for message in messages %}
  {% if message.user.id == current_user.id %}
  <p style="text-align:right">{{ message.message }}</p>
  <p style="text-align:right">{{ message.message_date }}</p><br>
  {% endif %}
  {% if message.user.id != current_user.id %}
  <p>{{ message.message }}</p>
  <p>{{ message.message_date }}</p><br>
  {% endif %}
{% endfor %}

  <script>
    function toBottom() {
      window.scrollTo(0, document.body.scrollHeight);
    }
    window.onload=toBottom;

  </script>

<!-- Text box -->
<div class="footer">
<br>
<form method="POST">
  <label for="message"></label>
  <textarea placeholder="Type a message to {{receiver.username}}..." id="message" name="message" style="max-width:95%;float: right" class="container"></textarea>
  <br>
  <br>
  <br>
  <input type="submit" value="Send" style="float: right;" class="send">
</form>
<br><br>
</div>


</div>
</body>
</html>